#!/usr/bin/env sh
case "${MACHTYPE:-}" in
  (*darwin*)
    swt_opt="-J-XstartOnFirstThread"
    ;;
esac

# see http://stackoverflow.com/a/1116890/1024897
TARGET_FILE=$0

cd `dirname "$TARGET_FILE"`
TARGET_FILE=`basename "$TARGET_FILE"`

# Iterate down a (possible) chain of symlinks
while [ -L "$TARGET_FILE" ]
do
    TARGET_FILE=`readlink "$TARGET_FILE"`
    cd `dirname "$TARGET_FILE"`
    TARGET_FILE=`basename "$TARGET_FILE"`
done

PHYS_DIR=`pwd -P`

RUBYSHOES="$PHYS_DIR/ruby-shoes"

cmd="jruby --1.9 ${swt_opt:-} $RUBYSHOES ${1}"
eval $cmd
